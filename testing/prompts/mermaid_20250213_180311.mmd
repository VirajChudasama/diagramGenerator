%%{init: {'theme': 'base', 'themeVariables': {'background': '#F5F5DC', 'primaryColor': '#87CEEB', 'edgeLabelBackground': '#FF4500'}}}%%
flowchart TD
    subgraph UserInteraction[User Interaction & Authentication]
        direction TB
        UI1[Users access via Web, Mobile, Smart TV, Gaming Console]:::lightblue
        UI2[Login via OAuth, Google, Facebook, Email]:::lightblue
        UI3[Multi-profile selection]:::lightblue
        UI4[Secure session handling]:::lightblue
    end

    subgraph ContentDiscovery[Content Discovery & Recommendation]
        direction TB
        CR1[Personalized homepage]:::lightgreen
        CR2[AI-powered recommendation using collaborative filtering & deep learning]:::lightgreen
        CR3[Search with filters like genre, language, release year]:::lightgreen
        CR4[Trending and Top 10 lists]:::lightgreen
    end

    subgraph ContentManagement[Content Management & CDN Distribution]
        direction TB
        CM1[Content stored in a distributed database, processed via CMS]:::lightyellow
        CM2[Encoding & transcoding for multiple resolutions]:::lightyellow
        CM3[CDN integration with edge servers]:::lightyellow
        CM4[DRM enforcement]:::lightyellow
    end

    subgraph StreamingPlayback[Streaming & Playback]
        direction TB
        SP1[Adaptive Bitrate Streaming for dynamic quality]:::lightorange
        SP2[Video player with subtitles, multi-audio tracks, playback speed control]:::lightorange
        SP3[Buffering, preloading for seamless experience]:::lightorange
        SP4[Watch history tracking & resume playback]:::lightorange
    end

    subgraph UserActivity[User Activity & Engagement Tracking]
        direction TB
        UA1[Real-time analytics on watch time, session duration]:::lightgrey
        UA2[AI-powered insights for better recommendations]:::lightgrey
        UA3[Parental controls & content restrictions]:::lightgrey
    end

    subgraph BillingSecurity[Billing & Subscription Management]
        direction TB
        BS1[Subscription plans – Basic, Standard, Premium]:::lightred
        BS2[Secure payment gateways – Credit/Debit Cards, PayPal, Apple Pay, Google Pay]:::lightred
        BS3[Auto-renewal & cancellation options]:::lightred
        BS4[Notifications for payment failures]:::lightred
    end

    subgraph SystemMonitoring[System Monitoring & Security]
        direction TB
        SM1[Load balancing for traffic distribution]:::lightgrey
        SM2[Logging, error handling, server health monitoring]:::lightgrey
        SM3[AI-driven fraud detection]:::lightgrey
        SM4[Compliance with GDPR, PCI-DSS, and regional data laws]:::lightgrey
    end

    %% Flow Connections %%
    UI1 --> UI2
    UI2 --> UI3
    UI3 --> UI4
    UI4 --> CR1
    CR1 --> CR2
    CR2 --> CR3
    CR3 --> CR4
    CR4 --> CM1
    CM1 --> CM2
    CM2 --> CM3
    CM3 --> CM4
    CM4 --> SP1
    SP1 --> SP2
    SP2 --> SP3
    SP3 --> SP4
    SP4 --> UA1
    UA1 --> UA2
    UA2 --> UA3
    SP4 --> BS1
    BS1 --> BS2
    BS2 --> BS3
    BS3 --> BS4
    SP4 --> SM1
    SM1 --> SM2
    SM2 --> SM3
    SM3 --> SM4

    classDef lightblue fill:#87CEEB;
    classDef lightgreen fill:#90EE90;
    classDef lightyellow fill:#FFFFE0;
    classDef lightorange fill:#FFCC99;
    classDef lightgrey fill:#D3D3D3;
    classDef lightred fill:#FFCCCB;