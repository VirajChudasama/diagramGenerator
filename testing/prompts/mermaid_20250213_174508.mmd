%%{init: {'theme': 'base', 'themeVariables': {'background': '#F5F5DC', 'primaryColor': '#87CEEB', 'tertiaryColor': '#FF4500'}}}%%
flowchart TD
    A[User Interaction & Authentication]:::userInteraction --> B[Content Discovery & Recommendation]:::recommendation
    B --> C[Content Management & CDN Distribution]:::contentManagement
    C --> D[Streaming & Playback]:::streamingPlayback
    D --> E[User Activity & Engagement Tracking]:::userActivity
    B --> E
    E --> F[Billing & Subscription Management]:::billing
    F --> G[System Monitoring & Security]:::security

    subgraph userInteraction [User Interaction & Authentication]
        direction TB
        A1[Users access via Web, Mobile, Smart TV, Gaming Console]
        A2[Login via OAuth, Google, Facebook, Email]
        A3[Multi-profile selection]
        A4[Secure session handling]
    end

    subgraph recommendation [Content Discovery & Recommendation]
        direction TB
        B1[Personalized homepage]
        B2[AI-powered recommendation using collaborative filtering & deep learning]
        B3[Search with filters like genre, language, release year]
        B4[Trending and Top 10 lists]
    end

    subgraph contentManagement [Content Management & CDN Distribution]
        direction TB
        C1[Content stored in a distributed database]
        C2[Processed via CMS]
        C3[Encoding & transcoding for multiple resolutions]
        C4[CDN integration with edge servers]
        C5[DRM enforcement]
    end

    subgraph streamingPlayback [Streaming & Playback]
        direction TB
        D1[Adaptive Bitrate Streaming for dynamic quality]
        D2[Video player with subtitles, multi-audio tracks, playback speed control]
        D3[Buffering, preloading for seamless experience]
        D4[Watch history tracking & resume playback]
    end

    subgraph userActivity [User Activity & Engagement Tracking]
        direction TB
        E1[Real-time analytics on watch time, session duration]
        E2[AI-powered insights for better recommendations]
        E3[Parental controls & content restrictions]
    end

    subgraph billing [Billing & Subscription Management]
        direction TB
        F1[Subscription plans – Basic, Standard, Premium]
        F2[Secure payment gateways – Credit/Debit Cards, PayPal, Apple Pay, Google Pay]
        F3[Auto-renewal & cancellation options]
        F4[Notifications for payment failures]
    end

    subgraph security [System Monitoring & Security]
        direction TB
        G1[Load balancing for traffic distribution]
        G2[Logging, error handling, server health monitoring]
        G3[AI-driven fraud detection]
        G4[Compliance with GDPR, PCI-DSS, and regional data laws]
    end

    %% Define styles for each subgraph
    classDef userInteraction fill:#87CEEB;
    classDef recommendation fill:#90EE90;
    classDef contentManagement fill:#FFD700;
    classDef streamingPlayback fill:#FFA07A;
    classDef userActivity fill:#D3D3D3;
    classDef billing fill:#FF6347;
    classDef security fill:#CD5C5C;