%%{init: {'theme': 'base', 'themeVariables': {'background': '#F5F5DC', 'primaryColor': '#87CEEB', 'edgeLabelBackground': '#FF4500'}}}%%
flowchart TD
    subgraph User Interaction [User Interaction & Authentication]
        direction TB
        UI1[Users access via Web, Mobile, Smart TV, Gaming Console]:::lightBlue
        UI2[Login via OAuth, Google, Facebook, Email]:::lightBlue
        UI3[Multi-profile selection]:::lightBlue
        UI4[Secure session handling]:::lightBlue
    end

    subgraph Recommendation [Content Discovery & Recommendation]
        direction TB
        R1[Personalized homepage]:::lightGreen
        R2[AI-powered recommendation using collaborative filtering & deep learning]:::lightGreen
        R3[Search with filters like genre, language, release year]:::lightGreen
        R4[Trending and Top 10 lists]:::lightGreen
    end

    subgraph Management [Content Management & CDN Distribution]
        direction TB
        C1[Content stored in a distributed database, processed via CMS]:::lightYellow
        C2[Encoding & transcoding for multiple resolutions]:::lightYellow
        C3[CDN integration with edge servers]:::lightYellow
        C4[DRM enforcement]:::lightYellow
    end

    subgraph Streaming [Streaming & Playback]
        direction TB
        S1[Adaptive Bitrate Streaming for dynamic quality]:::lightOrange
        S2[Video player with subtitles, multi-audio tracks, playback speed control]:::lightOrange
        S3[Buffering, preloading for seamless experience]:::lightOrange
        S4[Watch history tracking & resume playback]:::lightOrange
    end

    subgraph Analytics [User Activity & Engagement Tracking]
        direction TB
        A1[Real-time analytics on watch time, session duration]:::lightGrey
        A2[AI-powered insights for better recommendations]:::lightGrey
        A3[Parental controls & content restrictions]:::lightGrey
    end

    subgraph Billing [Billing & Subscription Management]
        direction TB
        B1[Subscription plans – Basic, Standard, Premium]:::lightRed
        B2[Secure payment gateways – Credit/Debit Cards, PayPal, Apple Pay, Google Pay]:::lightRed
        B3[Auto-renewal & cancellation options]:::lightRed
        B4[Notifications for payment failures]:::lightRed
    end

    subgraph Security [System Monitoring & Security]
        direction TB
        S1[Load balancing for traffic distribution]:::lightRed
        S2[Logging, error handling, server health monitoring]:::lightRed
        S3[AI-driven fraud detection]:::lightRed
        S4[Compliance with GDPR, PCI-DSS, and regional data laws]:::lightRed
    end

    %% Flow Connections
    UI1 --> R1
    UI2 --> R2
    UI3 --> R1
    UI4 --> R4

    R1 --> R2
    R2 --> R3
    R3 --> R4
    
    R2 --> C1
    C4 --> S1
    
    C1 --> C2
    C2 --> C3
    C3 --> S1

    S1 --> S2
    S2 --> S3
    S3 --> S4

    S4 --> A1
    A1 --> A2
    A1 --> A3

    A1 --> B1
    B1 --> B2
    B2 --> B3
    B3 --> B4

    R1 --> Analytics
    Analytics --> Security